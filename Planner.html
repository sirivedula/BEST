<html>
<head>
	<title>Planner</title>
	<script type="text/javascript" src="jquery-1.5.min.js"></script>
	<script type="text/javascript" src="jquery-ui-1.8.9.custom.min.js"></script>
	<link rel="Stylesheet" href="bestPlanner.css" />
	<link rel="Stylesheet" href="jquery-ui-1.8.10.custom.css" />
	
	<script type="text/javascript">
		
var PlannerDay = 1;
var PlannerWeek = 2;
var PlannerMonth = 3;

var autoStudents = [ { value:"0099-0099", label:"Student One" }, { value:"9090-9090", label:"Student Two" }, { value:"3", label:"Student Three" }, { value:"4", label:"Student Four" }, { value:"5", label:"Student Five" }, { value:"6", label:"Student Six" }, { value:"7", label:"Student Seven" }, { value:"8", label:"Student Eight" }, { value:"9", label:"Student Nine" }, { value:"10", label:"Student Ten" }, { value:"11", label:"Student Eleven" }, { value:"12", label:"Twelve" }, { value:"13", label:"Student Thirteen" }, { value:"14", label:"Student Fourteen" }, { value:"15", label:"Student Fifteen" }, { value:"16", label:"Student Sixteen" }, { value:"17", label:"Student Seventeen" }, { value:"18", label:"Student Eighteen" }, { value:"19", label:"Student Nineteen" }, { value:"20", label:"Student Twenty" } ];

var autoTutors = [ { value:"1234-99", label:"Tutor One" }, { value:"2121-99", label:"Tutor Two" }, { value:"3", label:"Tutor Three" }, { value:"4", label:"Tutor Four" }, { value:"5", label:"Tutor Five" }, { value:"6", label:"Tutor Six" }, { value:"7", label:"Tutor Seven" }, { value:"8", label:"Tutor Eight" }, { value:"9", label:"Tutor Nine" }, { value:"10", label:"Ten" }, { value:"11", label:"Eleven" }, { value:"12", label:"Twelve" }, { value:"13", label:"Tutor Thirteen" }, { value:"14", label:"Tutor Fourteen" }, { value:"15", label:"Tutor Fifteen" }, { value:"16", label:"Sixteen" }, { value:"17", label:"Tutor Seventeen" }, { value:"18", label:"Tutor Eighteen" }, { value:"19", label:"Tutor Nineteen" }, { value:"20", label:"Tutor Twenty" } ];

var StudentInfo = [ { "firstName" : "John", "lastName" : "Moore", "guid" : "0099-0099"}, 
					{ "firstName" : "Jimmy", "lastName" : "Woods", "guid" : "9090-9090" },
					{ "firstName" : "Carl", "lastName" : "Jones", "guid" : "990-990-990" },
					{ "firstName" : "Nims", "lastName" : "Bali", "guid" : "90909090-9000" },
					{ "firstName" : "Kelly", "lastName" : "Young", "guid" : "12345-12345" },
					{ "firstName" : "Chris", "lastName" : "Norris", "guid" : "123456-9000" },
					{ "firstName" : "Tony", "lastName" : "Ware", "guid" : "1234-9000" },
					{ "firstName" : "Ronnie", "lastName" : "Vance", "guid" : "12345-9000" },
					{ "firstName" : "Ella", "lastName" : "Flieschman", "guid" : "1234560-9000" },
					{ "firstName" : "Greta", "lastName" : "Flieschman", "guid" : "225544-9000" },
					{ "firstName" : "Koushik", "lastName" : "Musaboyina", "guid" : "445566-9000" },
					{ "firstName" : "Sai Teja", "lastName" : "Musaboyina", "guid" : "665544-9000" },
					{ "firstName" : "Bhargavi", "lastName" : "Musaboyina", "guid" : "778899-9000" }
				  ] ;
var TutorInfo = [{"Name" : "Balaji", "guid" : "1234-99"}, {"Name" : "Paul", "guid" : "2121-99"}, {"Name" : "Madhav", "guid" : "2121-990"}, {"Name" : "Surya Narayana", "guid" : "2121-9900"}, {"Name" : "Sudeep Bali", "guid" : "21210-099"}]

var ScheduleInfo = [];

/*var ScheduleInfo = [
{"schGuid":"123-321-120","stuGuid1":"9090-9090","tutGuid":"2121-99","schDate":"20110321","schFrom":"1430","schTo":"1530", "Index":"0" },
{"schGuid":"123-321-121","stuGuid1":"9090-9090","tutGuid":"2121-99","schDate":"20110321","schFrom":"1430","schTo":"1530", "Index":"1" },
{"schGuid":"123-321-122","stuGuid1":"9090-9090","tutGuid":"2121-99","schDate":"20110321","schFrom":"1430","schTo":"1530", "Index":"2" },
{"schGuid":"123-321-123","stuGuid1":"9090-9090","tutGuid":"2121-99","schDate":"20110321","schFrom":"1430","schTo":"1530", "Index":"3" },
{"schGuid":"123-321-124","stuGuid1":"9090-9090","tutGuid":"2121-99","schDate":"20110321","schFrom":"1330","schTo":"1430", "Index":"0" },
{"schGuid":"123-321-125","stuGuid1":"9090-9090","tutGuid":"2121-99","schDate":"20110321","schFrom":"1230","schTo":"1330", "Index":"0" },
{"schGuid":"123-321-126","stuGuid1":"9090-9090","tutGuid":"2121-99","schDate":"20110321","schFrom":"1230","schTo":"1330", "Index":"1" },
{"schGuid":"123-321-127","stuGuid1":"9090-9090","tutGuid":"2121-99","schDate":"20110321","schFrom":"1230","schTo":"1330", "Index":"2" },
{"schGuid":"123-321-128","stuGuid1":"9090-9090","tutGuid":"2121-99","schDate":"20110321","schFrom":"1230","schTo":"1330", "Index":"3" },
{"schGuid":"123-321-129","stuGuid1":"9090-9090","tutGuid":"2121-99","schDate":"20110321","schFrom":"1230","schTo":"1330", "Index":"4" },
{"schGuid":"123-321-110","stuGuid1":"9090-9090","tutGuid":"2121-99","schDate":"20110321","schFrom":"1230","schTo":"1330", "Index":"5" },
{"schGuid":"123-321-111","stuGuid1":"9090-9090","tutGuid":"2121-99","schDate":"20110322","schFrom":"1430","schTo":"1530", "Index":"0" },
{"schGuid":"123-321-112","stuGuid1":"9090-9090","tutGuid":"2121-99","schDate":"20110322","schFrom":"1430","schTo":"1530", "Index":"1" },
{"schGuid":"123-321-113","stuGuid1":"9090-9090","tutGuid":"2121-99","schDate":"20110322","schFrom":"1430","schTo":"1530", "Index":"2" },
{"schGuid":"123-321-114","stuGuid1":"9090-9090","tutGuid":"2121-99","schDate":"20110322","schFrom":"1430","schTo":"1530", "Index":"3" },
{"schGuid":"123-321-115","stuGuid1":"9090-9090","tutGuid":"2121-99","schDate":"20110323","schFrom":"1330","schTo":"1430", "Index":"0" },
{"schGuid":"123-321-116","stuGuid1":"9090-9090","tutGuid":"2121-99","schDate":"20110324","schFrom":"1230","schTo":"1330", "Index":"0" },
{"schGuid":"123-321-117","stuGuid1":"9090-9090","tutGuid":"2121-99","schDate":"20110324","schFrom":"1230","schTo":"1330", "Index":"1" },
{"schGuid":"123-321-118","stuGuid1":"9090-9090","tutGuid":"2121-99","schDate":"20110324","schFrom":"1230","schTo":"1330", "Index":"2" },
{"schGuid":"123-321-119","stuGuid1":"9090-9090","tutGuid":"2121-99","schDate":"20110324","schFrom":"1230","schTo":"1330", "Index":"3" },
{"schGuid":"123-321-100","stuGuid1":"9090-9090","tutGuid":"2121-99","schDate":"20110324","schFrom":"1230","schTo":"1330", "Index":"4" },
{"schGuid":"123-321-101","stuGuid1":"9090-9090","tutGuid":"2121-99","schDate":"20110324","schFrom":"1230","schTo":"1330", "Index":"5" },

{"schGuid":"123-321-102","stuGuid1":"9090-9090","tutGuid":"2121-99","schDate":"20110321","schFrom":"1530","schTo":"1630", "Index":"0" },
{"schGuid":"123-321-103","stuGuid1":"9090-9090","tutGuid":"2121-99","schDate":"20110321","schFrom":"1530","schTo":"1630", "Index":"1" },
{"schGuid":"123-321-104","stuGuid1":"9090-9090","tutGuid":"2121-99","schDate":"20110321","schFrom":"1530","schTo":"1630", "Index":"2" },
{"schGuid":"123-321-105","stuGuid1":"9090-9090","tutGuid":"2121-99","schDate":"20110321","schFrom":"1530","schTo":"1630", "Index":"3" },
{"schGuid":"123-321-106","stuGuid1":"9090-9090","tutGuid":"2121-99","schDate":"20110321","schFrom":"1630","schTo":"1730", "Index":"0" },
{"schGuid":"123-321-107","stuGuid1":"9090-9090","tutGuid":"2121-99","schDate":"20110321","schFrom":"1630","schTo":"1730", "Index":"1" },
{"schGuid":"123-321-108","stuGuid1":"9090-9090","tutGuid":"2121-99","schDate":"20110321","schFrom":"1630","schTo":"1730", "Index":"2" },
{"schGuid":"123-321-109","stuGuid1":"9090-9090","tutGuid":"2121-99","schDate":"20110321","schFrom":"1830","schTo":"1930", "Index":"0" },
{"schGuid":"123-321-130","stuGuid1":"9090-9090","tutGuid":"2121-99","schDate":"20110321","schFrom":"1830","schTo":"1930", "Index":"1" },
{"schGuid":"123-321-131","stuGuid1":"9090-9090","tutGuid":"2121-99","schDate":"20110321","schFrom":"1830","schTo":"1930", "Index":"2" },
{"schGuid":"123-321-132","stuGuid1":"9090-9090","tutGuid":"2121-99","schDate":"20110321","schFrom":"1830","schTo":"1930", "Index":"3" }];
*/

var aryTimes = ['630', '730', '830', '930', '1030', '1130', '1230', '1330', '1430', '1530', '1630', '1730', '1830', '1930', '2030',  '2130']

//var aryTimes = ['600', '630', '700', '730', '800', '830', '900', '930', '1000', '1030', '1100', '1130', '1200', '1230', '1300', '1330', '1400', '1430', '1500', '1530', '1600', '1630', '1700', '1730', '1800', '1830', '1900', '1930', '2000', '2030', '2100', '2130', '2200']

function Schedule(schguid, stguid1, stguid2, stguid3, stguid4, stguid5, tuguid, sdate, sfrom, sto, idx){
	this.schGuid = schguid;
	this.stuGuid1 = stguid1;
	this.stuGuid2 = stguid2;
	this.stuGuid3 = stguid3;
	this.stuGuid4 = stguid4;
	this.stuGuid5 = stguid5;
	this.tutGuid = tuguid;
	this.schDate = sdate;
	this.schFrom = sfrom;
	this.schTo = sto;
	this.Index = idx;
	this.topx = 0;
	this.leftx = 0;
	this.isNew = true;
	
	this.getDesc = function(){
		var stnames = new Array('', '', '', '', '');
		var stguids = new Array(this.stuGuid1, this.stuGuid2, this.stuGuid3, this.stuGuid4, this.stuGuid5);
		for(var i=0; i<5; i++){
			var objStd = BestPlanner.find(StudentInfo, function(obj){ return (obj.guid == stguids[i] ); });
			if(typeof objStd != 'undefined'){
				stnames[i] = objStd.firstName;
			}
		}
		var tutorguid = this.tutGuid;
		var objTutor = BestPlanner.find(TutorInfo, function(obj){ return (obj.guid == tutorguid); });
		var tuname = '';
		if(typeof objTutor != 'undefined'){
			tuname = objTutor.Name;
		}
		var thtml = '<div style="text-decoration:underline;text-align:left;font-weight:bold;">' + tuname +  '</div>'
		for(var i=0; i<5; i++){
			if(stnames[i] != ''){
				thtml += '<div style="text-align:right;font-size:9px;">' + stnames[i] + '</div>';
			}
		}
		return thtml;
	}
	
	this.getTimeHead = function(){
		
		return BestPlanner.formatTime(this.schFrom, true) + ' - ' +  BestPlanner.formatTime(this.schTo, true);
	}
	
	this.ToHTML = function(idx){
		var myDate = new Date(this.schDate);
		var clsnum = (this.schFrom%7 == 0) ? 2 : (this.schFrom%7); 
		clsname = 'day'+clsnum;
		var top1 = Number(this.topx)+14;
		return '<div style="position:absolute;top:'+this.topx+'px;left:'+this.leftx+'px;" id="timeSlice_' + this.schFrom + '_' + idx + '"><div class="' + clsname + 'head" ><span style="float:left;">'+this.getTimeHead() + '</span><span style="float:right;vertical-align:top;"><a style="border:0px; text-decoration:none;" href="javascript:void(0);" onclick="BestPlanner.editSchedule(\''+this.schFrom+'\',\'' + this.Index + '\');"><img style="vertical-align:top;border:0px;" src="images/bell_add.png" title="Edit schedule"></a></span></div><div class="' + clsname + 'body" style="position:absolute;top:12px;">' +  this.getDesc() + '</div></div>';
	}
}


var BestPlanner = function(){
	var plannerMode;	//Day, Week, Month
	var plannerDate;
	var beginTime = 6;
	var endTime = 22;
	var addDivSlice = "";
	var editTimeSlice = '';
	return {
		find : function(objList, delegate){
			for(var icnt in objList){
				if(delegate(objList[icnt])){
					return objList[icnt];
				}
			}
		}
		
		, findIndex : function(objList, delegate){
			for(var icnt in objList){
				if(delegate(objList[icnt])){
					return icnt;
				}
			}
			return -1;
		}
		
		, formatTime : function( strTime, zeroAdd ){
			var itime = Number(strTime);
			var stime = new String( ( itime > 1230 ) ? (itime-1200) : itime );
			var start = (stime.length > 3) ? 2 : 1;
			stime = stime.substr(0, start) + ((zeroAdd) ? ":" + stime.substr(start,2) : "") ;
			return stime;
		}
		
		, extendToSchedule : function(){
			for(var x in ScheduleInfo){
				var objSch = new Schedule();
				objSch.isNew = false;
				jQuery.extend(objSch, ScheduleInfo[x]);
				ScheduleInfo[x] = objSch;
			}
		}
		
		,updScheduleInfo : function(objSch){
			var schguid = objSch.schGuid;
			var idx = this.findIndex(ScheduleInfo, function(obj){ return (obj.schGuid == schguid); });
			if(idx > -1){
				ScheduleInfo[idx] = objSch;
			}
		}
		
		, AddSchedule : function(sguid1, sguid2, sguid3, sguid4, sguid5, tguid, sdate, sfrom, sto){
			var divslice = 'divSlice_' + sdate + '_' + sfrom
			var theIndex = this.MaxIndex(divslice);
			var newSch = new Schedule('new', sguid1, sguid2, sguid3, sguid4, sguid5, tguid, sdate, sfrom, sto, theIndex);
			ScheduleInfo[ScheduleInfo.length] = newSch;
			this.ReDraw(divslice);
		}
		
		, ReDraw : function(divslice){
			this.setDivAdjustment(divslice);
			this.clearAllSchedules();
			
			this.DrawSchedules();			
		}
		
		, UpdateSchedule : function(stguid1, stguid2, stguid3, stguid4, stguid5, tuguid, tfrom, tto){
			var objSch = $('#timeSlice_'+this.editTimeSlice).data();
			if(typeof objSch != 'undefined'){
				objSch.stuGuid1 = stguid1;
				objSch.stuGuid2 = stguid2;
				objSch.stuGuid3 = stguid3;
				objSch.stuGuid4 = stguid4;
				objSch.stuGuid5 = stguid5;
				objSch.tutGuid = tuguid;
				if(objSch.schFrom != tfrom){
					/* Time Changed */
					var odivslice = 'divSlice_'+objSch.schDate + '_' + objSch.schFrom;
					var ndivslice = 'divSlice_'+objSch.schDate + '_' + tfrom
					var theIndex = this.MaxIndex(ndivslice);
					objSch.schFrom = tfrom;
					objSch.schTo = tto;
					objSch.Index = theIndex;
					$('#timeSlice_'+tfrom+'_'+theIndex).data(objSch);
					this.clearAllSchedules();
					this.updScheduleInfo(objSch);
					this.ReIndex(odivslice);
					this.ReDraw(ndivslice);
				} else {
					/* Same Time */
					this.ShowSchedule(objSch);
				}
			}
		}		
		
		, clearAllSchedules : function(){
			var aryTimeSlice = [];
			for(var schIdx in ScheduleInfo){
				var objSch = ScheduleInfo[schIdx];
				var datetimediv = 'divSlice_' + objSch.schDate + '_' + objSch.schFrom;
				if(! this.findInArray(aryTimeSlice, datetimediv)){
					aryTimeSlice.push(datetimediv);
					$('#'+datetimediv).html('');
				}
			}
		}
		
		, setEditStudentText : function(textboxId, studentGuid){
				if(typeof studentGuid != 'undefined' && studentGuid != ''){
					$('#'+textboxId+'0').val(studentGuid);
					var objStd = BestPlanner.find(StudentInfo, function(obj){ return (obj.guid == studentGuid); });
					if(typeof objStd != 'undefined'){
						$('#'+textboxId).val(objStd.firstName);
					} else {
						$('#'+textboxId).val('');
					}
				}
		}
		
		, editSchedule : function( schFrom, Index ){
			this.editTimeSlice = schFrom+'_'+Index;
			var objSch = $('#timeSlice_'+this.editTimeSlice).data();
			if (objSch != null){
				var divSlice = '#divSlice_' + objSch.schDate + '_' + objSch.schFrom;
				var dleft = $(divSlice).position()["left"]+10;
				var dtop = $(divSlice).position()["top"]+10;
				$('#fromHour').val(objSch.schFrom);
				var ttime = Number(objSch.schFrom)+100;
				$('#toHour').val(ttime);
				$('#studentTag10,#studentTag20,#studentTag30,#studentTag40,#studentTag50,#tutorTag0').val('');
				$('#studentTag1,#studentTag2,#studentTag3,#studentTag4,#studentTag5,#tutorTag').val('');
				BestPlanner.setEditStudentText('studentTag1', objSch.stuGuid1);
				BestPlanner.setEditStudentText('studentTag2', objSch.stuGuid2);
				BestPlanner.setEditStudentText('studentTag3', objSch.stuGuid3);
				BestPlanner.setEditStudentText('studentTag4', objSch.stuGuid4);
				BestPlanner.setEditStudentText('studentTag5', objSch.stuGuid5);
				$('#tutorTag0').val(objSch.tutGuid);
				var tutorGuid = objSch.tutGuid;
				var objTut = BestPlanner.find(TutorInfo, function(obj){ return (obj.guid == tutorGuid); });
				$('#tutorTag').val(objTut.Name);
				
				$('#showScheduleDiv').dialog({autoOpen: true, width:350,height:215,title:'Edit Schedule', position: [dleft, dtop],
					buttons: [{ text: "Delete", click : function(){
							alert(schGuid);
						}
					}
					,{ text: "OK", click: function() { 
							if(BestPlanner.canSave()){
								var stguid1 = $('#studentTag10').val();
								var stguid2 = $('#studentTag20').val();
								var stguid3 = $('#studentTag30').val();
								var stguid4 = $('#studentTag40').val();
								var stguid5 = $('#studentTag50').val();
								
								var tuguid = $('#tutorTag0').val();
								var tfrom = $('#fromHour').val();
								var tto = $('#toHour').val();
								BestPlanner.UpdateSchedule(stguid1, stguid2, stguid3, stguid4, stguid5, tuguid, tfrom, tto);
								
								$(this).dialog("close");
							}
						}}] });	
				$('#showScheduleDiv').css('height','215px');
			}					
		}
		
		, PopupSchedule : function(divSlice){
			BestPlanner.addDivSlice = divSlice.id;
			var dleft = $(divSlice).position()["left"]+10;
			var dtop = $(divSlice).position()["top"]+10;
			var ftime = divSlice.id.split('_')[2];
			var ttime = Number(ftime)+100;
			$('#fromHour').val(ftime);
			$('#toHour').val(ttime);
			$('#studentTag10,#studentTag20,#studentTag30,#studentTag40,#studentTag50,#tutorTag0').val('');
			$('#studentTag1,#studentTag2,#studentTag3,#studentTag4,#studentTag5,#tutorTag').val('');
			
			$('#showScheduleDiv').dialog({position: [dleft, dtop], autoOpen: true, width:350,height:215,title:'Add Schedule',
				buttons: [{
				text: "OK", click: function() { 
						if(BestPlanner.canSave()){
							var stguid1 = $('#studentTag10').val();
							var stguid2 = $('#studentTag20').val();
							var stguid3 = $('#studentTag30').val();
							var stguid4 = $('#studentTag40').val();
							var stguid5 = $('#studentTag50').val();
							
							var tuguid = $('#tutorTag0').val();
							var tfrom = $('#fromHour').val();
							var tto = $('#toHour').val();
							var sdate = BestPlanner.ToyyyyMMdd(BestPlanner.selectDate());
							BestPlanner.AddSchedule(stguid1, stguid2, stguid3, stguid4, stguid5, tuguid, sdate, tfrom, tto);
							
							$(this).dialog("close"); 
						}
					}}] });
			$('#showScheduleDiv').css('height','215px');
		}
		
		, selectDate : function(){
			var datepart = BestPlanner.addDivSlice.split('_')[1];
			var tempdate = new Date(datepart.substr(4,2)+'/'+datepart.substr(6,2)+'/'+datepart.substr(0,4));
			return tempdate;
		}
		
		, canSave : function(){
			if($('#studentTag1').val().length == 0){
				alert('Select the Student');
				$('#studentTag1').focus();
				return false;
			}
			if($('#tutorTag').val().length == 0){
				alert('Select the Turor');
				$('tutorTag').focus();
				return false;
			}
			if ($('#fromHour').val().length == 0){
				alert('Select the From Time');
				$('#fromHour').focus();
				return false;
			}
			if ($('#toHour').val().length == 0){
				alert('Select the To Time');
				$('#toHour').focus();
				return false;
			}
			return true;
		}
		
		, Show : function(){
			var tutorsHtml = '';
			for(var x in TutorInfo){
				tutorsHtml += '<div class="TutorsDiv" id="TUDiv_' + x + '">' + TutorInfo[x].Name + '</div>';
			}
			$('#tdRest').html('<div>' + tutorsHtml + '</div>');
			
			if (this.plannerMode == PlannerDay){	
			
				/* Day Planner Drawing */
				var dayhtml = '<table class="weekTable" cellspacing="0" cellpadding="0" border="0"><tr><td style="width:45px;" id="tdTimes">&nbsp;</td>';
				var tdId = 'tdWeek_' + this.ToyyyyMMdd(this.plannerDate);
				dayhtml += '<td id="' + tdId + '">&nbsp;</td></tr></table>';
				$('#tdPlanner').html(dayhtml);
				this.DrawTimeSlice('tdTimes');
				this.DrawPlannerDay(tdId, this.plannerDate);
				
			} else if(this.plannerMode == PlannerWeek){
			
				/* Week Planner Drawing */
				
				var weekHtml = '<table class="weekTable" cellspacing="0" cellpadding="0" border="0"><tr><td style="width:45px;" id="tdTimes">&nbsp;</td>';
				
				var curweek = this.plannerDate.getDay() * -1;
				for(var i=curweek; i<curweek+7; i++){
					var curday = new Date(this.plannerDate);
					curday.setDate(curday.getDate() + i);
					weekHtml += '<td id="tdWeek_' + this.ToyyyyMMdd(curday) + '">&nbsp;</td>';
				}
				weekHtml += '</tr></table>';
				$('#tdPlanner').html(weekHtml);
				
				this.DrawTimeSlice('tdTimes');
				
				for(var i=curweek; i<curweek+7; i++){
					var curday = new Date(this.plannerDate);
					curday.setDate(curday.getDate() + i);
					var tdId = 'tdWeek_' + + this.ToyyyyMMdd(curday);
					this.DrawPlannerDay(tdId, curday);
				}
				
				
			} else if(this.plannerMode == PlannerMonth){			
				
				/* Month Planner Drawing */
				
			}
		}
		
		,DrawTimeSlice : function(tdId){
			tdSliceHtml = '<div class="tdHeadTitle">&nbsp;</div>';
			for(var tslice=0; tslice < aryTimes.length; tslice++){
				tdSliceHtml += '<div id="tdSlice_' + aryTimes[tslice] + '" class="tdSlice">' + this.formatTime( aryTimes[tslice], true ) + '</div>';
			}
			$('#'+tdId).html(tdSliceHtml);
		}
		
		,DrawPlannerDay : function(tdId, theDay){
			plannerHtml = '<div class="tdHeadTitle">' + this.ToMMddyyyy(theDay) + '</div>';
			var dropDivs = '';
			var tdWidth = $('#'+tdId).width()
			for(var tslice=0; tslice < aryTimes.length; tslice++){
				var divclass = (tslice%2==0)?"scaleeven" : "scaleodd";
				var sliceId = 'divSlice_' + this.ToyyyyMMdd(theDay) + '_' + aryTimes[tslice];
				plannerHtml += '<div class="' + divclass + '" id="'+ sliceId + '" ondblclick="BestPlanner.PopupSchedule(this);">&nbsp;</div>';
				dropDivs += '#' + sliceId + ',';
			}
			$('#'+tdId).html(plannerHtml);
			
			dropDivs = dropDivs.substr(0, dropDivs.length-1);
			$(dropDivs).droppable({
				hoverClass: "ui-state-active",
				drop: function( event, ui ) {
						/* Drag and Drop then setup to new from time, to time and ReDraw */
						var divSlice = '#' + $(this)[0].id;
						var timeSlice = '#' + ui.draggable[0].id;
						var curDate = divSlice.split('_')[1];
						var curFrom = divSlice.split('_')[2];
						
						var objSch = $(timeSlice).data();
						if(typeof objSch != 'undefined'){
							if(objSch.schFrom != curFrom){
								var odivslice = 'divSlice_' + objSch.schDate + '_' + objSch.schFrom;
								var ndivslice = 'divSlice_' + curDate + '_' + curFrom
								var theIndex = BestPlanner.MaxIndex(ndivslice);
								objSch.schDate = curDate;
								objSch.schFrom = curFrom;
								objSch.schTo = Number(curFrom)+100;
								objSch.Index = theIndex;
								$('#timeSlice_'+curFrom+'_'+theIndex).data(objSch);
								BestPlanner.clearAllSchedules();
								BestPlanner.updScheduleInfo(objSch);
								BestPlanner.ReIndex(odivslice);
								BestPlanner.ReDraw(ndivslice);
							}
						}
					}
				});			
		}
		
		,ToMMddyyyy : function(day){
			return day.getMonth()+1 + '/' + day.getDate() + '/' + day.getFullYear();
		}
		
		,ToyyyyMMdd : function(day){
			var mm = day.getMonth()+1;
			mm = (mm > 9 ? mm : '0' + mm);
			var dd = (day.getDate() > 9 ? day.getDate() : '0' + day.getDate());
			return day.getFullYear() + '' + mm + '' + dd;
		}
		
		, DrawSchedules : function(){
			this.fixDivHighWidth();
			for(var cnt in ScheduleInfo){
				if(this.plannerMode == PlannerWeek){
					this.ShowSchedule(ScheduleInfo[cnt]);
				} else if(this.plannerMode == PlannerDay){
					var curday = this.ToyyyyMMdd(this.plannerDate);
					if(curday == ScheduleInfo[cnt].schDate){
						this.ShowSchedule(ScheduleInfo[cnt]);
					}
				}
			}
		}
		
		, schedulePerRow : function(){
			if(this.plannerMode == PlannerWeek){
				return 4;
			} else if(this.plannerMode == PlannerDay){
				return 10;
			} else {
				return 1;
			}
		}
		
		, ShowSchedule : function(objSch){
			var slicediv = '#divSlice_' + objSch.schDate + '_' + objSch.schFrom;
			var Idx = Number(objSch.Index);
			var perRow = this.schedulePerRow();
			var schLeft = $(slicediv).position()['left'] +  ((Idx % perRow) * 105);
			var schTop = $(slicediv).position()['top'];
			
			schTop = (this.Divide(Idx, perRow) * 90) + schTop;
			
			objSch.leftx = schLeft;
			objSch.topx = schTop;			
			$(slicediv).append(objSch.ToHTML(Idx));
			$('#timeSlice_'+objSch.schFrom+'_'+Idx).draggable( { grid:[5,5] } );
			$('#timeSlice_'+objSch.schFrom+'_'+Idx).data(objSch);
		}
		
		, Divide : function( numerator, denominator ) {
			var remainder = numerator % denominator;
			var quotient = ( numerator - remainder ) / denominator;
			if ( quotient >= 0 )
				quotient = Math.floor( quotient );
			else  // negative
				quotient = Math.ceil( quotient );
				
			return quotient;
		}
			
		, MaxIndex : function(slicediv){
			var slicedate = slicediv.split('_')[1];
			var slicetime = slicediv.split('_')[2];
			var Count = 0;
			if(typeof slicedate != 'undefined' && typeof slicetime != 'undefined'){
				for(var cnt in ScheduleInfo){
					if(ScheduleInfo[cnt].schDate == slicedate){
						if(slicetime == ScheduleInfo[cnt].schFrom){
							Count++;
						}
					}
				}
			}
			return Count;
		}
		
		, ReIndex : function(slicediv){
			var slicedate = slicediv.split('_')[1];
			var slicetime = slicediv.split('_')[2];
			var Count = 0;
			if(typeof slicedate != 'undefined' && typeof slicetime != 'undefined'){
				for(var cnt in ScheduleInfo){
					if(ScheduleInfo[cnt].schDate == slicedate){
						if(slicetime == ScheduleInfo[cnt].schFrom){
							ScheduleInfo[cnt].Index = Count;
							Count++;
						}
					}
				}
			}
		}
		
		, fixDivHighWidth : function(){
			var aryTimeSlice = [];
			for(var schIdx in ScheduleInfo){
				var objSch = ScheduleInfo[schIdx];
				var datetimediv = 'divSlice_' + objSch.schDate + '_' + objSch.schFrom;
				if(! this.findInArray(aryTimeSlice, datetimediv)){
					aryTimeSlice.push(datetimediv);
					this.setDivAdjustment(datetimediv);
				}
			}
		}
		
		, setDivAdjustment : function(divSlice){
			var maxPlans = this.MaxIndex(divSlice);
			var datepart = divSlice.split('_')[1];	// yyyyMMdd format
			var timepart = divSlice.split('_')[2];
			var perRow = this.schedulePerRow();
			var numRows = this.Divide(maxPlans, perRow);
			var curDay = new Date(datepart.substr(4,2)+'/'+datepart.substr(6,2)+'/'+datepart.substr(0,4));
			var adjWidth = (maxPlans <= perRow) ? (maxPlans * 105) : (perRow * 105);
			this.setDivWidth(curDay, adjWidth);
			var adjHeight = (maxPlans > perRow) ? ((numRows+1) * 90) : 90;
			this.setDivHeight(timepart, adjHeight);
		}
		
		, findInArray : function(aryObj, item){
			var arylength = aryObj.length;
			for(var i=0; i<arylength; i++){
				if(aryObj[i] === item){
					return true;
				}
			}
			return false;
		}
		
		,setDivHeight : function(timeSlice, divH){
			$('#tdSlice_' + timeSlice).css('height', divH+'px');
			if(this.plannerMode == PlannerWeek){
				var curweek = this.plannerDate.getDay() * -1;
				for(var i=curweek; i<curweek+7; i++){
					var curday = new Date(this.plannerDate);
					curday.setDate(curday.getDate() + i);
					var divId = 'divSlice_' + this.ToyyyyMMdd(curday) + '_' + timeSlice;
					var curDivH = $('#'+divId).height();
					if(curDivH < divH){
						$('#'+divId).css('height', divH+'px');
					}
				}
			} else if (this.plannerMode == PlannerDay){
				var divId = 'divSlice_' + this.ToyyyyMMdd(this.plannerDate) + '_' + timeSlice;
				var curDivH = $('#'+divId).height();
				if(curDivH < divH){
					$('#'+divId).css('height', divH+'px');
				}
			}
		}
		
		,setDivWidth : function(theDay, divW){
			if(this.plannerMode == PlannerWeek){
				for(var tslice=0; tslice < aryTimes.length; tslice++){
					var sliceId = 'divSlice_' + this.ToyyyyMMdd(theDay) + '_' + aryTimes[tslice];
					var curDivW = $('#'+sliceId).width();
					if(curDivW < divW){
						$('#'+sliceId).css('width', divW+'px');
					}
				}
			} else if(this.plannerMode == PlannerDay){
				$('#tdWeek_' + this.ToyyyyMMdd(theDay)).css('width', '100%');
			}
		}
		
	} // end return
} (); // end Best Planner function object

function changeToTime(fromHour){
	var fh = Number(fromHour) + 1;
	$('#toHour').val(fh);
}	

    $(document).ready(function(){
		BestPlanner.plannerMode = PlannerDay;
		BestPlanner.plannerMode = PlannerWeek;
		BestPlanner.plannerDate = new Date('03/21/2011');
		BestPlanner.Show();
		BestPlanner.extendToSchedule();
		$("#radio").buttonset();
		
		$('#tutorTag').autocomplete( {source:autoTutors, delay: 0, select : 
			function( event, ui){ 
				$('#'+this.id+'0').val( ui.item.value );
				$( "#tutorTag" ).val( ui.item.label );
				return false; 
			} } );
		$('#studentTag1,#studentTag2,#studentTag3,#studentTag4,#studentTag5').autocomplete( { source:autoStudents, delay: 0, select : function( event, ui){ 
			$('#'+this.id+'0').val( ui.item.value );
			$( this ).val( ui.item.label ); 
			return false; 
		} } );
		
		setTimeout("BestPlanner.DrawSchedules();", 200);
    });
	
	function submit(theradio){
		theradio.checked = true;
		location = location;
	}
	</script>
</head>
<body style="text-align:center;">
	<div style="border-top:5px solid #2952a3;width:100%;text-align:center;">
		<table style="width:100%;font-family:Tahoma;font-size:11px;" cellspacing="0" cellpadding="0" border="0">
			<tr>
				<td style="background-color:#A6CFE9;padding-top:2px;padding-bottom:2px;">
					<table style="font-family:Tahoma;font-size:11px;width:100%;" cellspacing="0" cellpadding="0" border="0">
					<tr>
					<td><div style="float:left;padding-left:20px;"><img alt="previous" src="images/date_previous.png" class="imgarrows" title="Previous" />&nbsp;<img class="imgarrows" src="images/date_next.png" title="Next" />&nbsp;<a style="border:0px; text-decoration:none;" href="javascript:void(0);" onclick="Save();"><img style="cursor:pointer;border:0px;" src="images/disk.png" title="Save" /></a>&nbsp;<a style="vertical-align:top;font-weight:bold;color:#fff;" href="javascript:void(0);" onclick="Save();">Save</a></div></td>
					<td>
						<span style="font-family:Georgia;font-size:16px;padding-left:20px;width:100%;text-align:center;color:#FFF;font-weight:bold;text-decoration:underline;">Student Planner</span>
					</td>
					<td style="text-align:right; padding-right:20px;">
						<div id="radio">
							<input type="radio" id="radio1" name="pmoderadio" onclick="submit(this);"/><label for="radio1">Day</label>
							<input type="radio" id="radio2" name="pmoderadio" onclick="submit(this);"/><label for="radio2">Week</label>
							<input type="radio" id="radio3" name="pmoderadio" onclick="submit(this);"/><label for="radio3">Month</label>
						</div>
					</td>
					</tr>
					</table>
				</td>
				<td><input type="text" id="search" size="7" />&nbsp;<img style="cursor:pointer;"src="images/search.png" alt="..." /></td>
			</tr>
			<tr>
				<td id="tdPlanner" style="vertical-align:top;width:100%;"><div id="divPlanner" style="border:1px solid #d9d9d9;background-color:#E9E9F3;">Planner Drawn Area</div></td>
				<td style="width:80px;vertical-align:top;" id="tdRest">Students & Tutors Area</td>
			</tr>
		</table>
		
	</div>
	
	<!-- Schedule Dialog Div -->
	<div style="display:none;" id="showScheduleDiv">
		<table>
			<tr>
				<td class="ra">Tutor</td>
				<td><input id="tutorTag"><input type="hidden" id="tutorTag0" name="tutorTag0" /></td>
			</tr>
			<tr>
				<td class="ra">Student #1</td>
				<td><input id="studentTag1"><input type="hidden" id="studentTag10" name="studentTag10" /></td>
			</tr>
			<tr>
				<td class="ra">Student #2</td>
				<td><input id="studentTag2"><input type="hidden" id="studentTag20" name="studentTag20" /></td>
			</tr>
			<tr>
				<td class="ra">Student #3</td>
				<td><input id="studentTag3"><input type="hidden" id="studentTag30" name="studentTag30" /></td>
			</tr>
			<tr>
				<td class="ra">Student #4</td>
				<td><input id="studentTag4"><input type="hidden" id="studentTag40" name="studentTag40" /></td>
			</tr>
			<tr>
				<td class="ra">Student #5</td>
				<td><input id="studentTag5"><input type="hidden" id="studentTag50" name="studentTag50" /></td>
			</tr>
			<tr><td class="ra">From</td>
				<td style="line-height:17px;">
					<div style="line-height:17px;width:85px;"><div style="float:left;"><input type="text" id="fromHour" name="fromHour" size="8" maxlength="8" /></div><div style="float:right;"><img alt="^" src="images/ARW03UP.png" style="position:relative;display:block;top:0px;left:0px;cursor:pointer;height:8px;width:8px" onclick="PennyUpDown('fromHour', 1);" /><img src="images/ARW03DN.png" alt="V" style="position:relative;display:block;left:0px;top:2px;cursor:pointer;height:8px;width:8px;" onclick="PennyUpDown('fromHour', -1);" /></div></div>
				</td>
			</tr>
			<tr><td class="ra">To</td>
				<td>
					<div style="line-height:17px;width:85px;"><div style="float:left;"><input type="text" id="toHour" name="toHour" size="8" maxlength="8" /></div><div style="float:right;"><img alt="^" src="images/ARW03UP.png" style="position:relative;display:block;top:0px;left:0px;cursor:pointer;height:8px;width:8px" onclick="PennyUpDown('toHour', 1);" /><img src="images/ARW03DN.png" alt="V" style="position:relative;display:block;left:0px;top:2px;cursor:pointer;height:8px;width:8px;" onclick="PennyUpDown('toHour', -1);" /></div></div>				
				</td>
			</tr>
		</table>
	</div>
	
</body>
</html>